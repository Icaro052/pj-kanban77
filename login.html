<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Login - Kanban PCM Heineken</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen bg-gray-100 flex items-center justify-center font-sans">
  <div class="w-full max-w-md bg-white rounded-lg shadow p-6">
    <h1 class="text-2xl font-bold text-green-800 text-center mb-2">Kanban PCM - Heineken</h1>
    <p class="text-sm text-gray-600 text-center mb-4">Faça login para acessar o sistema</p>

    <div class="flex gap-2 mb-4">
      <button id="tab-login" class="flex-1 py-2 rounded bg-green-600 text-white">Entrar</button>
      <button id="tab-register" class="flex-1 py-2 rounded bg-gray-100 text-gray-700">Cadastrar</button>
    </div>

    <form id="login-form" class="space-y-3">
      <div>
        <label class="text-sm text-gray-700">E-mail</label>
        <input id="login-email" type="email" required class="w-full px-3 py-2 border rounded">
      </div>
      <div>
        <label class="text-sm text-gray-700">Senha</label>
        <input id="login-password" type="password" required class="w-full px-3 py-2 border rounded">
      </div>
      <p id="login-error" class="text-red-500 text-sm"></p>
      <button class="w-full py-2 bg-green-600 text-white rounded">Entrar</button>
    </form>

    <form id="register-form" class="space-y-3 hidden">
      <div>
        <label class="text-sm text-gray-700">E-mail</label>
        <input id="register-email" type="email" required class="w-full px-3 py-2 border rounded">
      </div>
      <div>
        <label class="text-sm text-gray-700">Senha (mín. 6)</label>
        <input id="register-password" type="password" minlength="6" required class="w-full px-3 py-2 border rounded">
      </div>
      <p id="register-error" class="text-red-500 text-sm"></p>
      <button class="w-full py-2 bg-green-600 text-white rounded">Cadastrar</button>
    </form>

    <p id="auth-status" class="mt-4 text-center text-sm text-gray-600"></p>
  </div>

  <script>
    // Autenticação simples usando localStorage
    const USERS_KEY = 'kanban_users_v1';
    const SESSION_KEY = 'kanban_user_v1';

    async function hashPassword(password) {
      const enc = new TextEncoder().encode(password);
      const digest = await crypto.subtle.digest('SHA-256', enc);
      return Array.from(new Uint8Array(digest)).map(b=>b.toString(16).padStart(2,'0')).join('');
    }
    function loadUsers(){ try { return JSON.parse(localStorage.getItem(USERS_KEY)||'{}'); } catch { return {}; } }
    function saveUsers(u){ localStorage.setItem(USERS_KEY, JSON.stringify(u)); }
    function setSession(email){ localStorage.setItem(SESSION_KEY, email); }
    function getSession(){ return localStorage.getItem(SESSION_KEY); }

    document.addEventListener('DOMContentLoaded', ()=> {
      const tabLogin = document.getElementById('tab-login');
      const tabRegister = document.getElementById('tab-register');
      const loginForm = document.getElementById('login-form');
      const registerForm = document.getElementById('register-form');
      const loginEmail = document.getElementById('login-email');
      const loginPassword = document.getElementById('login-password');
      const loginError = document.getElementById('login-error');
      const registerEmail = document.getElementById('register-email');
      const registerPassword = document.getElementById('register-password');
      const registerError = document.getElementById('register-error');
      const authStatus = document.getElementById('auth-status');

      if (getSession()) {
        authStatus.textContent = 'Já autenticado. Redirecionando...';
        setTimeout(()=> location.href = '/index.html', 400);
        return;
      }

      tabLogin.addEventListener('click', ()=>{
        tabLogin.classList.add('bg-green-600','text-white'); tabLogin.classList.remove('bg-gray-100','text-gray-700');
        tabRegister.classList.add('bg-gray-100','text-gray-700'); tabRegister.classList.remove('bg-green-600','text-white');
        loginForm.classList.remove('hidden'); registerForm.classList.add('hidden');
        loginError.textContent = ''; registerError.textContent = '';
      });

      tabRegister.addEventListener('click', ()=>{
        tabRegister.classList.add('bg-green-600','text-white'); tabRegister.classList.remove('bg-gray-100','text-gray-700');
        tabLogin.classList.add('bg-gray-100','text-gray-700'); tabLogin.classList.remove('bg-green-600','text-white');
        registerForm.classList.remove('hidden'); loginForm.classList.add('hidden');
        loginError.textContent = ''; registerError.textContent = '';
      });

      loginForm.addEventListener('submit', async (e)=>{
        e.preventDefault();
        loginError.textContent = '';
        const email = loginEmail.value.trim().toLowerCase();
        const pw = loginPassword.value;
        if (!email || !pw) { loginError.textContent = 'Preencha e-mail e senha.'; return; }
        const users = loadUsers();
        if (!users[email]) { loginError.textContent = 'Usuário não encontrado.'; return; }
        const h = await hashPassword(pw);
        if (h !== users[email]) { loginError.textContent = 'Senha inválida.'; return; }
        setSession(email);
        authStatus.textContent = 'Login bem-sucedido. Redirecionando...';
        setTimeout(()=> location.href = '/index.html', 300);
      });

      registerForm.addEventListener('submit', async (e)=>{
        e.preventDefault();
        registerError.textContent = '';
        const email = registerEmail.value.trim().toLowerCase();
        const pw = registerPassword.value;
        if (!email || !pw || pw.length < 6) { registerError.textContent = 'E-mail e senha (mín.6) são obrigatórios.'; return; }
        const users = loadUsers();
        if (users[email]) { registerError.textContent = 'E-mail já cadastrado.'; return; }
        const h = await hashPassword(pw);
        users[email] = h;
        saveUsers(users);
        authStatus.textContent = 'Cadastro realizado com sucesso. Faça login.';
        tabLogin.click();
      });
    });
  </script>
</body>
</html>